# ---------------------------------------------------------------------------
# Global SSH Configuration (chezmoi-managed)
# ---------------------------------------------------------------------------

# Skip unknown options on older or newer OpenSSH versions.
IgnoreUnknown AddKeysToAgent,UseKeychain,ForwardAgent

# Disable host name hashing for easier host readability.
HashKnownHosts no

# ---------------------------------------------------------------------------
# Global defaults
# ---------------------------------------------------------------------------
Host *
    # Connection multiplexing (reuse SSH sessions)
    ControlMaster auto
    ControlPath ~/.ssh/controlmasters/%r@%h:%p
    ControlPersist 60m

    # Key management
    AddKeysToAgent yes
{{- if (eq .chezmoi.os "darwin") }}
    UseKeychain yes
{{- end }}
    ForwardAgent yes
    IdentitiesOnly yes

    # Keep-alive and reliability
    ServerAliveInterval 60
    ServerAliveCountMax 30

# ---------------------------------------------------------------------------
# Work-specific includes
# ---------------------------------------------------------------------------
{{- if .work }}
    {{- if (stat "~/.ssh/akamai.cfg").Exists }}
Include ~/.ssh/akamai.cfg
    {{- end }}
    {{- if (stat "~/.ssh/linode.cfg").Exists }}
Include ~/.ssh/linode.cfg
    {{- end }}
{{- end }}

# ---------------------------------------------------------------------------
# Personal and host-specific configurations
# ---------------------------------------------------------------------------

Host scot-syno
    HostName 146.115.24.74
    Port 8988
    User rishid

Host github github.com github-rishid
    HostName github.com
    User git
    # Disable multiplexing for GitHub (socket reuse can trigger odd auth issues)
    ControlMaster no
    IdentitiesOnly yes
    IdentityFile ~/.ssh/github_rishid

# ---------------------------------------------------------------------------
# Notes:
#   • Ensure ~/.ssh/controlmasters directory exists:
#       mkdir -p ~/.ssh/controlmasters && chmod 700 ~/.ssh/controlmasters
#   • Ensure correct file permissions:
#       chmod 600 ~/.ssh/config
#   • chezmoi OS detection via .chezmoi.os -> "darwin", "linux", etc.
# ---------------------------------------------------------------------------
