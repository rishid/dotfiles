#!/usr/bin/env bash
# Update local dev environment using ansible-playbook.
# Optionally pass role names.
set -e

cd "${BASH_SOURCE%/*}/.."

git pull origin master

join() {
    IFS="$1"
    shift
    echo "$*"
}

if [[ $# -gt 0 ]]; then
    tags="--tags=$(join , $@)"
fi

if [[ $# -eq 0 ]]; then
 # Run all roles except for the ones tagged with 'bootstrap'
  echo "Updating local dev environment..."
  ansible-playbook -i hosts --skip-tags "bootstrap" dotfiles.yml  
else
  echo "Updating local dev environment... (--tags $@)"
  ansible-playbook -i hosts \
  --extra-vars whoami="$(whoami)" \
  --extra-vars whoami_group="$(id -gn)"
  --skip-tags "bootstrap" --tags $@
  dotfiles.yml  
fi
